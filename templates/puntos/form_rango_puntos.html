{% extends "base.html" %}
{% load static %}
{% block title %}{{ titulo }}{% endblock %}

{% block extra_css %}
<style>
    .form-card {
        border: none;
        border-radius: 15px;
        overflow: hidden;
    }
    
    .form-header {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        color: white;
        padding: 2rem;
    }
    
    .preview-card {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        border-radius: 15px;
        padding: 2rem;
        border: 2px solid #8b5cf6;
    }
    
    .input-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #8b5cf6;
    }
    
    .input-with-icon {
        padding-left: 45px;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        transition: all 0.3s ease;
    }
    
    .input-with-icon:focus {
        border-color: #8b5cf6;
        box-shadow: 0 0 0 0.2rem rgba(139, 92, 246, 0.25);
    }
    
    .btn-guardar {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        border: none;
        color: white;
        font-weight: 600;
        padding: 0.75rem 2rem;
    }
    
    .btn-guardar:hover {
        background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
        color: white;
        transform: translateY(-2px);
    }
</style>
{% endblock %}

{% block content %}
<div class="content-header">
    <h1 class="page-title">
        <i class="fas fa-sliders-h me-2"></i>{{ titulo }}
    </h1>
    <p class="text-muted">Configure el rango de montos y puntos a otorgar</p>
</div>

<div class="content-section">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            
            {% if messages %}
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                    <i class="fas fa-exclamation-circle me-2"></i>{{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                {% endfor %}
            {% endif %}

            <form method="POST" id="formRango">
                {% csrf_token %}
                
                <div class="card form-card shadow-lg mb-4">
                    <div class="form-header text-center">
                        <i class="fas fa-chart-line fa-3x mb-3"></i>
                        <h3 class="mb-0">Configuración del Rango</h3>
                    </div>
                    
                    <div class="card-body p-4">
                        <!-- Montos -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">
                                    <i class="fas fa-dollar-sign text-primary me-2"></i>
                                    Monto Mínimo *
                                </label>
                                <div class="position-relative">
                                    <span class="input-icon">
                                        <i class="fas fa-dollar-sign"></i>
                                    </span>
                                    <input type="number" 
                                           step="0.01" 
                                           name="monto_minimo" 
                                           id="monto_minimo"
                                           class="form-control form-control-lg input-with-icon" 
                                           value="{{ rango.monto_minimo|default:'' }}" 
                                           required
                                           min="0"
                                           placeholder="0.00">
                                </div>
                                <small class="form-text text-muted">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Monto mínimo del rango
                                </small>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-semibold">
                                    <i class="fas fa-dollar-sign text-primary me-2"></i>
                                    Monto Máximo *
                                </label>
                                <div class="position-relative">
                                    <span class="input-icon">
                                        <i class="fas fa-dollar-sign"></i>
                                    </span>
                                    <input type="number" 
                                           step="0.01" 
                                           name="monto_maximo" 
                                           id="monto_maximo"
                                           class="form-control form-control-lg input-with-icon" 
                                           value="{{ rango.monto_maximo|default:'' }}" 
                                           required
                                           min="0"
                                           placeholder="0.00">
                                </div>
                                <small class="form-text text-muted">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Monto máximo del rango
                                </small>
                            </div>
                        </div>

                        <!-- Puntos -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">
                                <i class="fas fa-star text-warning me-2"></i>
                                Puntos a Otorgar *
                            </label>
                            <div class="position-relative">
                                <span class="input-icon">
                                    <i class="fas fa-star text-warning"></i>
                                </span>
                                <input type="number" 
                                       name="puntos_otorgados" 
                                       id="puntos_otorgados"
                                       class="form-control form-control-lg input-with-icon" 
                                       value="{{ rango.puntos_otorgados|default:'' }}" 
                                       required
                                       min="1"
                                       placeholder="0">
                            </div>
                            <small class="form-text text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                Cantidad de puntos que recibirá el cliente
                            </small>
                        </div>

                        <!-- Estado -->
                        <div class="mb-4">
                            <div class="form-check form-switch">
                                <input class="form-check-input" 
                                       type="checkbox" 
                                       name="activo" 
                                       id="activo"
                                       style="width: 50px; height: 25px;"
                                       {% if rango.activo or not rango %}checked{% endif %}>
                                <label class="form-check-label ms-2 fw-semibold" for="activo">
                                    <i class="fas fa-toggle-on text-success me-2"></i>
                                    Rango Activo
                                </label>
                            </div>
                            <small class="form-text text-muted ms-5">
                                Solo los rangos activos se aplicarán al calcular puntos
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Vista Previa -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-light">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-eye text-info me-2"></i>
                            Vista Previa
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="preview-card text-center">
                            <p class="mb-2 text-muted">Compras entre:</p>
                            <h4 class="mb-3">
                                <span class="badge" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                                    $<span id="preview_min">0</span>
                                </span>
                                <span class="mx-2">y</span>
                                <span class="badge" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                                    $<span id="preview_max">0</span>
                                </span>
                            </h4>
                            <p class="mb-2 text-muted">Otorgarán:</p>
                            <h2 class="mb-0">
                                <span class="badge" style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); font-size: 1.5rem;">
                                    <i class="fas fa-star me-2"></i>
                                    <span id="preview_puntos">0</span> puntos
                                </span>
                            </h2>
                        </div>
                    </div>
                </div>

                <!-- Botones -->
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex justify-content-end gap-3">
                            <a href="{% url 'rangos_puntos' %}" class="btn btn-outline-secondary btn-lg">
                                <i class="fas fa-times me-2"></i>Cancelar
                            </a>
                            <button type="submit" class="btn btn-guardar btn-lg">
                                <i class="fas fa-check me-2"></i>{{ accion }}
                            </button>
                        </div>
                    </div>
                </div>
            </form>

            <!-- Consejos -->
            <div class="card border-0 shadow-sm mt-4">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-lightbulb text-warning me-2"></i>
                        Consejos
                    </h5>
                </div>
                <div class="card-body">
                    <ul class="mb-0">
                        <li class="mb-2">El monto mínimo debe ser menor al monto máximo</li>
                        <li class="mb-2">Evite solapar rangos para prevenir confusiones</li>
                        <li class="mb-2">Puede crear múltiples rangos con diferentes cantidades de puntos</li>
                        <li>Los rangos inactivos no se aplicarán, pero se mantendrán guardados</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const montoMin = document.getElementById('monto_minimo');
    const montoMax = document.getElementById('monto_maximo');
    const puntos = document.getElementById('puntos_otorgados');
    
    function actualizarPreview() {
        document.getElementById('preview_min').textContent = montoMin.value || '0';
        document.getElementById('preview_max').textContent = montoMax.value || '0';
        document.getElementById('preview_puntos').textContent = puntos.value || '0';
    }
    
    montoMin.addEventListener('input', actualizarPreview);
    montoMax.addEventListener('input', actualizarPreview);
    puntos.addEventListener('input', actualizarPreview);
    
    // Validación
    document.getElementById('formRango').addEventListener('submit', function(e) {
        const min = parseFloat(montoMin.value);
        const max = parseFloat(montoMax.value);
        
        if (min >= max) {
            e.preventDefault();
            alert('⚠️ El monto mínimo debe ser menor al monto máximo');
            montoMax.focus();
        }
    });
    
    // Inicializar preview
    actualizarPreview();
});
</script>
{% endblock %}